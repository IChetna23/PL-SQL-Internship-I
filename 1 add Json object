# add json ob1 - procedure

create or replace PROCEDURE ADD_JSON_OBJECT1(EMPID IN NUMBER, COLLID IN VARCHAR2)
AS
V_JSON_OBJ_LAF JSON_OBJECT_T;
V_JSON_OBJ_LAF_DETAILS JSON_OBJECT_T;
V_RESULT JSON_ELEMENT_T;
V_LAF_OBJ_lAF_DETAILS1 JSON_OBJECT_T;
OBJECT_D CLOB;
NEW_OBJ CLOB;
INSERTED_OBJ JSON_ELEMENT_T;
OBJ_T JSON_OBJECT_T;

BEGIN
SELECT OBJECT_DATA INTO OBJECT_D FROM employee_data EMP WHERE EMP.ID = EMPID;

  V_JSON_OBJ_LAF   := TREAT(JSON_ELEMENT_T.PARSE(OBJECT_D) AS JSON_OBJECT_T);
  V_RESULT     := V_JSON_OBJ_LAF.GET('LAF');
  v_json_obj_laf_details := TREAT (V_RESULT AS JSON_OBJECT_T);
  V_RESULT := v_json_obj_laf_details.GET('LAF_DETAILS');
  V_LAF_OBJ_lAF_DETAILS1 := TREAT (V_RESULT AS JSON_OBJECT_T);
  
  INSERTED_OBJ := JSON_ELEMENT_T.PARSE(JSON_OBJECT('CODE' VALUE '1','VALUE' VALUE 'DIRECT'));
  
  OBJ_T := TREAT(INSERTED_OBJ AS JSON_OBJECT_T);
  
  V_LAF_OBJ_lAF_DETAILS1.PUT('SOURCING_TEAM',OBJ_T);
  NEW_OBJ := v_json_obj_laf.TO_CLOB();
  UPDATE EMPLOYEE_DATA
     SET OBJECT_DATA = NEW_OBJ 
     WHERE ID = EMPID ;
  COMMIT;
END;
